---
title: "Exploration enrichment pathways with differentially expressed (DE) genes between old versus young "
author: "Team Le Grand"
date: "`r format(Sys.time(),'%d %B,%Y')`"
output:
  rmarkdown::html_document:
    theme: lumen
    df_print : paged
    fig_width: 15
    fig_height: 12
    toc: true
    toc_float: true

   
---

<style type="text/css">


h1.title {
  background-color: #158cba;
  font-size: 34px;
  color: white;
}
h1 { /* Header 1 */
  background-color: #158cba;
  font-size: 23px;
    color: white;
}
h2 { /* Header 2 */
  background-color: #158cba ;
  font-size: 20px;
    color: white;
}
h3 { /* Header 3 */
  background-color: #158cba ;
  font-size: 14px;
    color: white;
}
tr:nth-child(even){background-color: #f2f2f2;}

tr:hover {background-color: #ddd;}

th {
  background-color: #84c1d8ff;
  color: white;
}

</style>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, rows.print=5)
```
```{r pathsLoads , echo=FALSE,warning=FALSE,message=FALSE }

library(tidyverse)
library(ComplexHeatmap)
library(msigdbr)
library(cowplot)
library(openxlsx)
library(arcdiagram)
library(devtools)
library(igraph)
library(DESeq2)
library(ggrepel) #Â for labels to point
library(rmarkdown)
library(shiny)
library(prettydoc)
library(ggnewscale)
library(htmlwidgets)
library(circlepackeR) 
library(igraph)
library(data.tree)
library(gridExtra)
library(kableExtra)
library(formattable)
library(knitr)
library(DT)
library(ggnewscale)
library(reshape2)
library(oce)
library(ggraph)
library(plyr)
library(spaceNtime)

home<-"/home/bioinfo/BulkAnalysis_plusNetwork2/"
analyse<-"analysis/AnalysisGSEA/"
odir <- "/home/bioinfo/BulkAnalysis_plusNetwork2/exam_INTER_conditions/static/"
gseardsFull = "GSEA/rds/"
gseacsvFull= "GSEA/csv/"
tablesneeded <- T
mat4heatmapneeded <- T


#Loads
gseaoutfull2padj = "fgsea_padj_full.rds" 
gseaout_filtered_full2padj = "fgsea_padj_filtered.rds" 

#Created
GSEAconcatPath<-paste0(odir,gseardsFull,"GSEAconcat.rds")
GSEAconcatsigniPath<-paste0(odir,gseardsFull,"GSEAconcatSigni.rds")
CountNormalizedYoungPath<-paste0(odir,"csv/YoungCountNormalized")
CountNormalizedOldPath<-paste0(odir,"csv/OldCountNormalized")

##################################
#### Load files
##################################

fullrds <- readRDS(paste0(odir,gseardsFull, gseaoutfull2padj))
pathsFiltered = readRDS( paste0(odir, gseardsFull,  gseaout_filtered_full2padj) )


thegmt <- msigdbr(species = "Mus musculus", 
                  category = 'C2', 
                  subcategory=c('CP:REACTOME'))
msigdbr_list = split(x = thegmt$gene_symbol, f = thegmt$gs_name)

fullDEsta = readRDS(paste0(odir, "rds/shot_rds_full.rds"))

genes_df <- read.table(paste0(home,"data/genesinfo.csv"), sep="\t", header=T)

daysv<-list()
daysv<-lapply( unique(fullDEsta$type), function(t) unique(fullDEsta[fullDEsta$type == t,]$day) )
names(daysv)<-unique(fullDEsta$type)
Typecellv<-unique(fullDEsta$type)
days<-unique(fullDEsta$day)

if (file.exists(GSEAconcatsigniPath) == F ){

XX_full = readRDS(paste0(odir,gseardsFull, gseaoutfull2padj))
GSEAconcat<-tibble() # table concat to explore combinaison pathway signi
for ( t in Typecellv ){
  for (d in daysv[[t]]){
    GSEAconcat<-rbind(GSEAconcat, XX_full[[d]][[t]] %>% mutate(day=d) %>% mutate(type=t))
  }
}

GSEAsigni<- GSEAconcat %>% filter(padj<=0.05) %>% arrange(day,type) %>% mutate(sens=ifelse(NES < 0,"down", "up"))

saveRDS(GSEAconcat,GSEAconcatPath)
saveRDS(GSEAsigni,GSEAconcatsigniPath)

}else{
  GSEAconcat=readRDS(GSEAconcatPath)
  GSEAsigni=readRDS(GSEAconcatsigniPath)
}
if ( file.exists(CountNormalizedOldPath) == F){
concatMeanCountNormalized<-function(age){
  tempoTable<-read.table(paste0('data/meanCountNormalised_',age,'_D0.ECs.txt'))
  nbligne=length(tempoTable$GeneID)
  GeneID=tempoTable$GeneID
  age.meanCountNormalizedtable<-data_frame(tempoTable,type = rep("ECs",nbligne),days = rep("D0",nbligne))
  for ( t in Typecellv){
    for (day in daysv[[t]]){
    tempoTable<-read.table(paste0('data/meanCountNormalised_',age,'_',day,'.',t,'.txt'))
    nbligne=length(tempoTable$GeneID)
    if(GeneID == tempoTable$GeneID){
      tempo<-data_frame(tempoTable,type = rep(t,nbligne),days = rep(day,nbligne))
      age.meanCountNormalizedtable<-rbind(age.meanCountNormalizedtable,tempo)
    }
    }
  }
  age.meanCountNormalizedtable <- age.meanCountNormalizedtable %>% mutate( symbol = genes_df[match(age.meanCountNormalizedtable$GeneID, genes_df$Geneid),]$symbol)
  age.meanCountNormalizedtable <- age.meanCountNormalizedtable %>% unite( 'GeneDayType' , symbol:days:type ,sep = '_',remove = F)
  return(age.meanCountNormalizedtable)
}

CountNormalizedYoung<-concatMeanCountNormalized('Young')
CountNormalizedOld<-concatMeanCountNormalized('Old')
write.table(CountNormalizedYoung,CountNormalizedYoungPath)
write.table(CountNormalizedOld,CountNormalizedOldPath)
}else{
  CountNormalizedYoung=read.table(CountNormalizedYoungPath)
  CountNormalizedOld=read.table(CountNormalizedOldPath)
}

#############
####Functions
############

#color
darker.col = function(color, how.much = 30){
  colorRampPalette(c("white",color,"black"))(9)[how.much]
}
tablecolor<-data.frame("ECs"=darker.col("#0072B2", c(4:7,5)),"FAPs"=darker.col("#F0E442", c(3:6,7)),"M1"=darker.col("#D55E00", c(3:6,6)),"M2"=darker.col("#CC79A7", c(3:6,6)),"Neutro"=darker.col("#009E73", c(3:6,6)),"sCs"=darker.col("#56B4E9",c(2:5,6)))
rownames(tablecolor)<-c("D0","D2","D4","D7","Police")
hsl_color<-data.frame("ECs"=270,"FAPs"=56,"M1"=26,"M2"=327,"Neutro"=164,"sCs"=202)



## NewTable with NbCondSigni, CondSigni: Day1_Type1_Sens1.Day_Type2_Sens2 ..., DayTypeSens,NbPathWithDynamique,color
DynamicPathwayAcrossCond <- function(RepartitionPathway,GSEAsigni,n){
  PathwaySigniCond<-RepartitionPathway %>% filter(Freq==n)
  PathwaySigniCondtable<- lapply(PathwaySigniCond$Var1 , function(x) dplyr::filter(GSEAsigni, pathway == x))
  DynamicCond <-lapply(PathwaySigniCondtable, function(x) paste0(x$day,'_',x$type,'_',x$sens) %>% sort())
  names(DynamicCond)<-lapply(PathwaySigniCondtable, function(x) unique(x$pathway) )
  DynamicCondconcat<-c()
  for(Dym in DynamicCond){DynamicCondconcat=c(DynamicCondconcat,str_c(Dym,collapse = " "))}
  names(DynamicCondconcat)<-lapply(PathwaySigniCondtable, function(x) unique(x$pathway))
  Dynamiquetable<-ldply(lapply(PathwaySigniCondtable, function(x) as.data.frame(cbind(rep(n,n),x,paste0(x$day,'_',x$type,'_',x$sens),rep(DynamicCondconcat[[unique(x$pathway)]],n)))),rbind)
  colnames(Dynamiquetable)<-c("NbCondSigni",colnames(PathwaySigniCondtable[[1]]),"DayTypeSens","CondSigni")
  
  Dynamique<-lapply(unique(Dynamiquetable$pathway), function(x) unique(Dynamiquetable %>% filter(pathway==x) %>% select(CondSigni) %>% unlist())) %>% unlist()
  names(Dynamique)<-unique(Dynamiquetable$pathway)
  tableDynamique<-table(Dynamique)
  Dynamiquetable <- Dynamiquetable %>% mutate(NbPathWithDynamique=as.numeric(as.character(tableDynamique[match(Dynamiquetable$CondSigni,names(tableDynamique))]))) %>% mutate(color=as.character(tablecolor["D4",match(Dynamiquetable$type,colnames(tablecolor))])) %>% arrange(desc(NbPathWithDynamique))
  Dynamiquetable <- Dynamiquetable %>% mutate( DayType = paste0(day,'_',type))
  Dynamiquetable <-  Dynamiquetable %>% mutate( link=paste0("<a href='","../exam_INTER_conditions/static/",analyse,"PathwayEnrichedIn",n,"DayTypeCell/",pathway,"_meanCountNormalizedGene.html","'>FigureSupp</a>"))

  Dynamiquetable <-  Dynamiquetable %>% mutate( NamePathway= str_replace(str_replace_all(pathway,"_"," "), "REACTOME",""))

  return(Dynamiquetable)
}


#Plot of Pathway in function NES
GetPlot<-function(Dynamic6table,GSEAsigni, nbCond , vertical){
  col<- Dynamic6table %>% arrange(type) %>% select(color) %>% unlist() %>% as.character() %>% unique()
  Dynamic6table <-Dynamic6table %>% mutate( CondSigni = as.factor(CondSigni)) %>% mutate(CondSigni = fct_reorder(CondSigni, as.numeric(NbPathWithDynamique), .desc = T) )
  
  typebytime<-ggplot(Dynamic6table, aes(x=day,y=as.numeric(NES),fill=type,color=type,group=paste0(pathway,'_',type))) +
    geom_point(aes(size=as.numeric(NbPathWithDynamique),alpha=0.7),show.legend = c(size=T,alpha=F))+
    scale_size_binned(name="Number path",limits=c(1,MaxNbPaathWithSameDyn))+
    ylab("NES")+
    geom_line()+
    geom_hline(yintercept = 0, color="black", linetype="dashed",lwd=0.5,slope=F)+
    scale_color_manual(values=col)+
    ggtitle( paste0("Pathways with ",nbCond," conditions enriched")) +
    facet_wrap(~CondSigni+NbPathWithDynamique ,dir = "v", ncol=vertical,labeller = labeller(NbPathWithDynamique = label_facet(Dynamic6table$NbPathWithDynamique,"Number pathways: ")))+
    theme_linedraw()+ theme(strip.text  = element_text(size = 11 , face = "bold"),strip.background = element_rect(fill="grey"),panel.grid.major.x = element_line(color = "gray60", size = 0.8),axis.title= element_text(face="bold"),axis.text = element_text(face="bold",size=14))
  print(typebytime)
  save_plot(paste0(odir, analyse, 'Pathway_enriched_in__',nbCond ,'conditions_Plot2.svg'),typebytime, base_height = 10,
            base_width = 14)
}



```
# Genes Set Enrichment Analysis (GSEA) results

--------

GSEA on all genes. This analysis is done by day and cell type on list of genes ranked by padj decreasing. The data base use is genes set from Molecular Signatures DataBase (MSigDB) species : 

  - species  = Mus musculus 
  - category C2 = online pathway databases and the biomedical literature curated ([more details](https://www.gsea-msigdb.org/gsea/msigdb/collection_details.jsp#C2)
  - subcategory = Canonical pathways ,Reactome database
Composed by 1604 pathways. 


## Descriptives statistics

--------

How many pathways are significatives (padj<0.05)

```{r caclcStat1, echo=FALSE,warning=FALSE,message=FALSE }
################################################# 
# Extract stats significant pathways enrichied
#################################################
NumberPathwaysSigni = array(NA, dim=c(length(days),length(Typecellv)))
rownames(NumberPathwaysSigni) =  days
colnames(NumberPathwaysSigni) = Typecellv
NumberPathwaysUniqueOnOneDay<-c()
NumberPathwaysUniqueOnOneTypeCell<-c()
for (t in Typecellv){
  link=paste0("[", GSEAsigni %>% filter(type==t) %>% select(pathway) %>% unique() %>% unlist() %>% length(),"](../exam_INTER_conditions/static/",analyse,'_',t,"/",'_',t,"_Hierarchical_Figsupp.html)")
  NumberPathwaysUniqueOnOneTypeCell<-c(NumberPathwaysUniqueOnOneTypeCell,link)
  for (d in daysv[[t]]){
    link=paste0("[",dim(GSEAsigni %>% filter(day==d & type==t))[1],"](../exam_INTER_conditions/static/",analyse,d,'_',t,"/",d,'_',t,"_Hierarchical_Figsupp.html)")
    if ( dim(GSEAsigni %>% filter(day==d & type==t))[1] == 0){
      NumberPathwaysSigni[d, t] <-0
      }
    else{NumberPathwaysSigni[d, t] <- link}
    if (t == Typecellv[1]){
      link=paste0("[",GSEAsigni %>% filter(day==d) %>% select(pathway) %>% unique() %>% unlist() %>% length(),"](../exam_INTER_conditions/static/",analyse,d,'_',"/",d,'_',"_Hierarchical_Figsupp.html)")
       NumberPathwaysUniqueOnOneDay<-c(NumberPathwaysUniqueOnOneDay,link)

    }
  }
}

names(NumberPathwaysUniqueOnOneDay)<-days
names(NumberPathwaysUniqueOnOneTypeCell)<-Typecellv
NumberPathwaysSigni<-cbind(NumberPathwaysSigni,NumberPathwayEnrichedByDay=NumberPathwaysUniqueOnOneDay)
NumberPathwaysSigni<-rbind(NumberPathwaysSigni,NumberPathwayEnrichedByTypeCell=c(NumberPathwaysUniqueOnOneTypeCell,""))
TotalUniquePathway=length(unique(GSEAsigni$pathway))

```


`r kbl(NumberPathwaysSigni,row.names = TRUE)%>%kable_paper("striped")`



```{r violinPlotAllNES, fig.align='center', echo=FALSE, warning=FALSE , error=FALSE}
###  CALCULATE
# Visualization of path significative
#
# ====================== Calculate =============================

ViolinDay<-c()
ViolinCell<-c()
ViolinValue<-c()
for (d in days){
  for (typeCell in Typecellv){
  #keep table with signi gene
  tempoGSEAsigni<- GSEAsigni %>% dplyr::filter(day==d&type==typeCell)
  for (l in 1:length(tempoGSEAsigni)){
      ViolinDay<-c(ViolinDay,d)
      ViolinCell<-c(ViolinCell,typeCell)
      ViolinValue<-c(ViolinValue,tempoGSEAsigni[l,]$NES)
    }
  }
}
Violindata<-data.frame(ViolinDay=ViolinDay,
                       ViolinCell=ViolinCell,
                       ViolinValue=ViolinValue)

PlotDEGonlyOneDayVioline<-ggplot(Violindata, aes(x=ViolinCell ,y=ViolinValue, fill=ViolinCell)) + # fill=name allow to automatically dedicate a color for each group
  geom_jitter(shape=16, position=position_jitter(0.4), aes(color=ViolinCell,alpha=0.001), show.legend=F)+geom_violin(scale="count",aes(alpha=0.001),show.legend = c("alpha"=F))+
  scale_fill_manual(values =c("#0072B2","#F0E442" ,"#D55E00","#CC79A7","#009E73","#56B4E9"))+scale_color_manual(values =c("#0072B2","#F0E442" ,"#D55E00","#CC79A7","#009E73","#56B4E9"))+
  coord_flip() + scale_x_discrete(limits=rev) +facet_grid(cols=vars(ViolinDay), switch = "both") +
  theme(panel.grid.major=element_blank(),axis.text.x = element_text(angle = 45)) +ylab("NES of pathways padj <0.05")+xlab("Type Cell") +
  theme_minimal()
PlotDEGonlyOneDayVioline
```

### Inspected Hierarchical Classement of pathway in REACTOME

--------

All condition combined, there are `r TotalUniquePathway` pathway enriched. 
In this representation only pathway with upper letter are enriched in at least one condition.

-----------

```{r HierarchicalTotalPlot, echo=FALSE,warning=FALSE,message=FALSE }
data_nested_2=read.table( file=paste0( odir,analyse,"ALL_table_REACTOME_Hierachie.txt"))
data_nested_2[is.na(data_nested_2)] <- ""
data_nested_2$pathString <- paste("roots", data_nested_2$level1, data_nested_2$level2, data_nested_2$level3, data_nested_2$level4,data_nested_2$level5,data_nested_2$level6,data_nested_2$level7, data_nested_2$level8, data_nested_2$level9, data_nested_2$level10,data_nested_2$level11,data_nested_2$level12, sep = "/")
data_Node <-as.Node(data_nested_2)

p <- circlepackeR(data_Node, size = "value",color_min = paste0("hsl(56,80%,80%)"), color_max = paste0("hsl(341,30%,30%)"), width = 1800, height = 1000)

p

```

----------`

```{r HierarchicalTotaltable, echo=FALSE,warning=FALSE,message=FALSE }

tableHierarchie<-read.table(paste0(odir,analyse,"ALL_table_REACTOME_Hierachie_print.txt") )
 DT::datatable(tableHierarchie, filter = 'top', extensions = c('RowGroup','Select', 'SearchPanes'),options = list(rowGroup = list(dataSrc = c(1,2)),dom = 'Pfrtip',columnDefs = list(list(searchPanes = list(show = FALSE), targets = 3:12 ))),selection = 'none',escape = F)
```


--------

## Inspected the repartition of enrichied pathways across days and type cell 

------------

```{r caclcStat2, echo=FALSE,warning=FALSE,message=FALSE }
RepartitionPathwaySummary<-table(table(GSEAsigni$pathway))
RepartitionPathwaySummary<- data.frame("Numbers conditions enrichis"="Numbers pathways","1"=RepartitionPathwaySummary[1], "2"=RepartitionPathwaySummary[2],"3"=RepartitionPathwaySummary[3],"4"=RepartitionPathwaySummary[4],"5"=RepartitionPathwaySummary[5],"6"=RepartitionPathwaySummary[6],"7"=RepartitionPathwaySummary[7],"8"=RepartitionPathwaySummary[8])
colnames(RepartitionPathwaySummary)=c("Numbers conditions enrichis",1:8)
RepartitionPathway<-as.data.frame(table(GSEAsigni$pathway))


```

Number pathway `r kbl(RepartitionPathwaySummary,row.names = F)%>%kable_paper("striped")`


```{r CalTableDynamic, echo=FALSE,warning=FALSE,message=FALSE,  paged.print=TRUE, fig.show='asis', fig.fullwidth=TRUE}

Dynamic8table=DynamicPathwayAcrossCond(RepartitionPathway,GSEAsigni,8)
Dynamic7table=DynamicPathwayAcrossCond(RepartitionPathway,GSEAsigni,7)
Dynamic6table=DynamicPathwayAcrossCond(RepartitionPathway,GSEAsigni,6)
Dynamic5table=DynamicPathwayAcrossCond(RepartitionPathway,GSEAsigni,5)
Dynamic4table=DynamicPathwayAcrossCond(RepartitionPathway,GSEAsigni,4)
Dynamic3table=DynamicPathwayAcrossCond(RepartitionPathway,GSEAsigni,3)
Dynamic2table=DynamicPathwayAcrossCond(RepartitionPathway,GSEAsigni,2)
Dynamic1table=DynamicPathwayAcrossCond(RepartitionPathway,GSEAsigni,1)
MaxNbPaathWithSameDyn<-max(Dynamic8table$NbPathWithDynamique,Dynamic7table$NbPathWithDynamique,Dynamic6table$NbPathWithDynamique,Dynamic5table$NbPathWithDynamique,Dynamic4table$NbPathWithDynamique,Dynamic3table$NbPathWithDynamique,Dynamic2table$NbPathWithDynamique,Dynamic1table$NbPathWithDynamique )

```

### Pathways founds enriched in 8 conditions

-------

```{r PlotcombiPathwayCond8, echo=FALSE,warning=FALSE,message=FALSE,  paged.print=TRUE, fig.show='asis', fig.fullwidth=TRUE}
GetPlot(Dynamic8table,GSEAconcat,8,1)
listPlotTable <- Dynamic8table %>% select(CondSigni,NamePathway,link,DayTypeSens,padj,NES,NbPathWithDynamique)
DT::datatable(listPlotTable, filter = 'top', extensions = c('RowGroup','Select', 'SearchPanes'),options = list(rowGroup = list(dataSrc = c(1,2)),dom = 'Pfrtip',columnDefs = list(list(searchPanes = list(show = FALSE), targets = 3:7 ))),selection = 'none',escape = F)
```

### Pathways founds enriched in 7 conditions

----------

```{r PlotcombiPathwayCond7, echo=FALSE,warning=FALSE,message=FALSE,  paged.print=TRUE, fig.show='asis', fig.fullwidth=TRUE}
GetPlot(Dynamic7table,GSEAconcat,7,1)
listPlotTable <- Dynamic7table %>% select(CondSigni,NamePathway,link,DayTypeSens,padj,NES,NbPathWithDynamique)
DT::datatable(listPlotTable, filter = 'top', extensions = c('RowGroup','Select', 'SearchPanes'),options = list(rowGroup = list(dataSrc = c(1,2)),dom = 'Pfrtip',columnDefs = list(list(searchPanes = list(show = FALSE), targets = 3:7 ))),selection = 'none',escape = F)
```


### Pathways founds enriched in 6 conditions

-------

```{r PlotcombiPathwayCond6, echo=FALSE,warning=FALSE,message=FALSE,  paged.print=TRUE, fig.show='asis', fig.fullwidth=TRUE}
GetPlot(Dynamic6table,GSEAconcat,6,1)
listPlotTable <- Dynamic6table %>% select(CondSigni,NamePathway,link,DayTypeSens,padj,NES,NbPathWithDynamique)
DT::datatable(listPlotTable, filter = 'top', extensions = c('RowGroup','Select', 'SearchPanes'),options = list(rowGroup = list(dataSrc = c(1,2)),dom = 'Pfrtip',columnDefs = list(list(searchPanes = list(show = FALSE), targets = 3:7 ))),selection = 'none',escape = F)
```

### Pathways founds enriched in 5 conditions

------

```{r PlotcombiPathwayCond5, echo=FALSE,warning=FALSE,message=FALSE,  fig.show='asis', paged.print=TRUE}
GetPlot(Dynamic5table,GSEAconcat,5,2)
listPlotTable <- Dynamic5table %>% select(CondSigni,NamePathway,link,DayTypeSens,padj,NES,NbPathWithDynamique)
DT::datatable(listPlotTable, filter = 'top', extensions = c('RowGroup','Select', 'SearchPanes'),options = list(rowGroup = list(dataSrc = c(1,2)),dom = 'Pfrtip',columnDefs = list(list(searchPanes = list(show = FALSE), targets = 3:7 ))),selection = 'none',escape = F)
```

### Pathways founds enriched in 4 conditions

--------

```{r PlotcombiPathwayCond4, echo=FALSE, fig.show='asis', message=FALSE, warning=FALSE, paged.print=TRUE}
GetPlot(Dynamic4table,GSEAconcat,4,2)
listPlotTable <- Dynamic4table %>% select(CondSigni,NamePathway,link,DayTypeSens,padj,NES,NbPathWithDynamique)
DT::datatable(listPlotTable, filter = 'top', extensions = c('RowGroup','Select', 'SearchPanes'),options = list(rowGroup = list(dataSrc = c(1,2)),dom = 'Pfrtip',columnDefs = list(list(searchPanes = list(show = FALSE), targets = 3:7 ))),selection = 'none',escape = F)

``` 

### Pathways founds enriched in 3 conditions

--------

```{r PlotcombiPathwayCond3, echo=FALSE, fig.show='asis', message=FALSE, warning=FALSE, paged.print=TRUE}
GetPlot(Dynamic3table,GSEAconcat,3,NA)
listPlotTable <- Dynamic3table %>% select(CondSigni,NamePathway,link,DayTypeSens,padj,NES,NbPathWithDynamique)
DT::datatable(listPlotTable, filter = 'top', extensions = c('RowGroup','Select', 'SearchPanes'),options = list(rowGroup = list(dataSrc = c(1,2)),dom = 'Pfrtip',columnDefs = list(list(searchPanes = list(show = FALSE), targets = 3:7 ))),selection = 'none',escape = F)

``` 

### Pathways founds enriched in 2 conditions

---------

```{r PlotcombiPathwayCond2, echo=FALSE, fig.show='asis', message=FALSE, warning=FALSE, paged.print=TRUE}
GetPlot(Dynamic2table,GSEAconcat,2,NA)
listPlotTable <- Dynamic2table %>% select(CondSigni,NamePathway,link,DayTypeSens,padj,NES,NbPathWithDynamique)
DT::datatable(listPlotTable, filter = 'top', extensions = c('RowGroup','Select', 'SearchPanes'),options = list(rowGroup = list(dataSrc = c(1,2)),dom = 'Pfrtip',columnDefs = list(list(searchPanes = list(show = FALSE), targets = 3:7 ))),selection = 'none',escape = F)
``` 

### Pathways founds enrichired in 1 condition

-----


```{r PlotcombiPathwayCond1, echo=FALSE, fig.show='asis', message=FALSE, warning=FALSE, paged.print=TRUE}
GetPlot(Dynamic1table,GSEAconcat,1,NA)
listPlotTable <- Dynamic1table %>% select(CondSigni,NamePathway,link,DayTypeSens,padj,NES,NbPathWithDynamique)
DT::datatable(listPlotTable, filter = 'top', extensions = c('RowGroup','Select', 'SearchPanes'),options = list(rowGroup = list(dataSrc = c(1)),dom = 'Pfrtip',columnDefs = list(list(searchPanes = list(show = FALSE), targets = 3:7 ))),selection = 'none',escape = F)
``` 

### Table Recapitulatif

-----


```{r TableRecap, echo=FALSE, fig.show='asis', message=FALSE, warning=FALSE, paged.print=TRUE}
Dynamictable<-rbind(Dynamic8table,Dynamic7table,Dynamic6table,Dynamic5table,Dynamic4table,Dynamic3table,Dynamic2table,Dynamic1table)
listPlotTable <- Dynamictable %>% select(DayTypeSens,NamePathway,CondSigni,NbCondSigni,link,day,type,padj,NES,NbPathWithDynamique) %>% arrange(DayTypeSens,NamePathway,CondSigni,desc(NbCondSigni))
DT::datatable(listPlotTable, filter = 'top', extensions = c('RowGroup','Select', 'SearchPanes'),options = list(rowGroup = list(dataSrc = c(1,2,3)),dom = 'Pfrtip',columnDefs = list(list(searchPanes = list(show = FALSE), targets = 4:9 ))),selection = 'none',escape = F)
``` 
